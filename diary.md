# AHC011


## 2022-05-29

ルールベースで動かすのなら、各タイルの行き先を最初に完全に決めてしまうのは解を限定しすぎてる気がする。
毎回近い所から合う形状のタイルを探してくるのがよさそう。

そうするとパリティが合わない場合が出てきそうだけど、1/2で当たるんだろうからランダム性入れて何回か繰り返せばそのうち当たるでしょうということで。

動いた。単純な貪欲しかしてなくて改善点ありまくりだけど平均70万点近く出てそうで良い感じ。

```
seed:0001 score=6633
seed:0002 score=6953
seed:0003 score=6955
seed:0004 score=7255
seed:0005 score=7338
seed:0006 score=7070
seed:0007 score=7187
seed:0008 score=6811
seed:0009 score=7250
```

とりあえずすぐ思いつくような改善をいろいろ入れたら74万点くらいにまではなった

```
seed:0001 score=7332
seed:0002 score=7549
seed:0003 score=7551
seed:0004 score=7345
seed:0005 score=7824
seed:0006 score=7522
seed:0007 score=7314
seed:0008 score=7366
seed:0009 score=7420
seed:0010 score=7662
```

時間の使い方が同じアルゴリズムを繰り返してるだけだから、もうちょっとなんかやりたいが

今は残りサイズ3になったら全探索してるけど、サイズ4でできないか？

N大だと焼きなましでターゲット盤面探すところがボトルネックになってる
=> 焼きなましの初期温度下げたらだいぶ良くなった

時間の前半は乱択して、結果が一番良かったターゲット盤面に対してビームサーチとか？
=> ビームサーチじゃなくて、とりあえず結果が一番良かったターゲット盤面に対して乱択を繰り返すようにしたらけっこう上がった。

```
seed:0001 score=7901
seed:0002 score=7725
seed:0003 score=7778
seed:0004 score=7665
seed:0005 score=8032
seed:0006 score=7857
seed:0007 score=7803
seed:0008 score=7716
seed:0009 score=7785
seed:0010 score=7755
```


既存の解に対してその作り方の一部を変化させる近傍って意味あるんかなあ、ハーフマラソンの魔法使いXの戦いで使えたみたいな


1回提出しておくか
=> 1位 39,029,302 （2位は38,307,047）

自環境よりは1%弱高めに出た。
最終的にはまず40は超えるんやろうなあ


今回ちょっとレアケースでのバグ死が怖いので大量テストは早めにやっておこう


## 2022-05-28

スコア計算式的に、完全な木を作るのは前提になるだろう。

まず思いついた方針

1. タイルの種類ごとに個数を数える
1. スライド操作は気にせず任意の配置で木にする
1. 元の盤面からのマッピングを作る
1. あとは普通のスライドパズルを解く

木にするのがどれくらい実現可能なものなのか次第かな。

閉路が出来たらダメだけど、木になっている=全タイルが連結になっているなら、閉路無く木になっているとは言って良さそう。

マッピング作ってスライドパズル解くのは普通にやればできるだろうけど、手数最小化をヒューリスティックで頑張る感じ。

マッピング作るときにはパリティ合わせないとゴールできないのに注意。

適当に焼きなますことでどれくらい大きな木にできるかをやってみる。

これC++のほうが良かったりしないかな…悩む

Nが5種類しかないからtemplateで定数化しちゃって高速化というのもできるし（Crystalでもマクロ使いこなせばできるのではあろうけど…）

ビームサーチするだろうからnth_element使いたいんよなあ

C++で書くことにした。

木を作っている様子がわかるビジュアライザ作ろう
=> いや、後でやった焼きなましですぐに見つかることがわかったので作らなくていいか

> 適当に焼きなますことでどれくらい大きな木にできるかをやってみる

ちょっと実験的に書いたけど焼きなましでは難しそうな感がある。DFSしてみる
=> ちょっと書こうとしたけど実装難しそう、別方針を考える

C++用のAWS Batch環境を作っていたら、既存のコンピューティング環境がc3系を使うようになっていたことに気付いたのでc5系を使うように更新した

ターゲット盤面、タイルの種類の個数のパターンごとに埋め込めたりする…？　さすがにパターン数多いか？
一応生成してどんな分布になっているか見てみよう
=> さすがに全然無理だった

適当な木を作って、それに辺を足してどこかを切ってという遷移で個数が合うまでやる、で焼いてみよう。これは良い感じの遷移になりそうな予感がする
=> 割とすぐ見つかってくれた。やった。1000ケース回したけど大丈夫っぽい。

ふつうのスライドパズルに帰着できたけど、それ解くのもけっこう難しいな。
適当なビームサーチじゃ全然揃わない

ルールベースに1行ずつ揃える=>1行揃えるのを単位としてビームサーチ、
としてみようか

いっぱい書いてたら初日で1000行超えてしまった

